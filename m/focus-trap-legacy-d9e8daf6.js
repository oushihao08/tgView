System.register(["./vue-legacy-ad0cdcd9.js","./index-legacy-7f75df50.js","./aria-legacy-ceb005ad.js","./index-legacy-06c116be.js","./lodash-es-legacy-9b7a5f41.js"],(function(e,t){"use strict";var n,o,s,r,a,u,c,d,i,l,f,p,v,m,E;return{setters:[e=>{n=e.ad,o=e.b,s=e.l,r=e.r,a=e.k,u=e.p,c=e.w,d=e.u,i=e.n,l=e.Y,f=e.O},e=>{p=e._},e=>{v=e.E},e=>{m=e.c},e=>{E=e.i}],execute:function(){e("c",((...e)=>t=>{e.forEach((e=>{n(e)?e(t):e.value=t}))}));let t=[];const y=e=>{const n=e;n.key===v.esc&&t.forEach((e=>e(n)))},w="focus-trap.focus-after-trapped",h="focus-trap.focus-after-released",L={cancelable:!0,bubbles:!1},b={cancelable:!0,bubbles:!1},T="focusAfterTrapped",g="focusAfterReleased",k=e("F",Symbol("elFocusTrap")),F=r(),R=r(0),S=r(0);let K=0;const N=e=>{const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{const t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0||e===document.activeElement?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t},P=(e,t)=>{for(const n of e)if(!I(n,t))return n},I=(e,t)=>{if("hidden"===getComputedStyle(e).visibility)return!0;for(;e;){if(t&&e===t)return!1;if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1},j=(e,t)=>{if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),S.value=window.performance.now(),e!==n&&(e=>e instanceof HTMLInputElement&&"select"in e)(e)&&t&&e.select()}};function _(e,t){const n=[...e],o=e.indexOf(t);return-1!==o&&n.splice(o,1),n}const x=(()=>{let e=[];return{push:t=>{const n=e[0];n&&t!==n&&n.pause(),e=_(e,t),e.unshift(t)},remove:t=>{var n,o;e=_(e,t),null==(o=null==(n=e[0])?void 0:n.resume)||o.call(n)}}})(),C=()=>{F.value="pointer",R.value=window.performance.now()},A=()=>{F.value="keyboard",R.value=window.performance.now()},O=()=>(o((()=>{0===K&&(document.addEventListener("mousedown",C),document.addEventListener("touchstart",C),document.addEventListener("keydown",A)),K++})),s((()=>{K--,K<=0&&(document.removeEventListener("mousedown",C),document.removeEventListener("touchstart",C),document.removeEventListener("keydown",A))})),{focusReason:F,lastUserFocusTimestamp:R,lastAutomatedFocusTimestamp:S}),D=e=>new CustomEvent("focus-trap.focusout-prevented",{...b,detail:e}),q=a({name:"ElFocusTrap",inheritAttrs:!1,props:{loop:Boolean,trapped:Boolean,focusTrapEl:Object,focusStartEl:{type:[Object,String],default:"first"}},emits:[T,g,"focusin","focusout","focusout-prevented","release-requested"],setup(e,{emit:n}){const a=r();let f,p;const{focusReason:b}=O();var F;F=t=>{e.trapped&&!K.paused&&n("release-requested",t)},o((()=>{0===t.length&&document.addEventListener("keydown",y),m&&t.push(F)})),s((()=>{t=t.filter((e=>e!==F)),0===t.length&&m&&document.removeEventListener("keydown",y)}));const K={paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}},I=t=>{if(!e.loop&&!e.trapped)return;if(K.paused)return;const{key:o,altKey:s,ctrlKey:r,metaKey:a,currentTarget:u,shiftKey:c}=t,{loop:d}=e,i=o===v.tab&&!s&&!r&&!a,l=document.activeElement;if(i&&l){const e=u,[o,s]=(e=>{const t=N(e);return[P(t,e),P(t.reverse(),e)]})(e);if(o&&s)if(c||l!==s){if(c&&[o,e].includes(l)){const e=D({focusReason:b.value});n("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),d&&j(s,!0))}}else{const e=D({focusReason:b.value});n("focusout-prevented",e),e.defaultPrevented||(t.preventDefault(),d&&j(o,!0))}else if(l===e){const e=D({focusReason:b.value});n("focusout-prevented",e),e.defaultPrevented||t.preventDefault()}}};u(k,{focusTrapRef:a,onKeydown:I}),c((()=>e.focusTrapEl),(e=>{e&&(a.value=e)}),{immediate:!0}),c([a],(([e],[t])=>{e&&(e.addEventListener("keydown",I),e.addEventListener("focusin",A),e.addEventListener("focusout",q)),t&&(t.removeEventListener("keydown",I),t.removeEventListener("focusin",A),t.removeEventListener("focusout",q))}));const _=e=>{n(T,e)},C=e=>n(g,e),A=t=>{const o=d(a);if(!o)return;const s=t.target,r=t.relatedTarget,u=s&&o.contains(s);e.trapped||r&&o.contains(r)||(f=r),u&&n("focusin",t),K.paused||e.trapped&&(u?p=s:j(p,!0))},q=t=>{const o=d(a);if(!K.paused&&o)if(e.trapped){const s=t.relatedTarget;E(s)||o.contains(s)||setTimeout((()=>{if(!K.paused&&e.trapped){const e=D({focusReason:b.value});n("focusout-prevented",e),e.defaultPrevented||j(p,!0)}}),0)}else{const e=t.target;e&&o.contains(e)||n("focusout",t)}};async function B(){await i();const t=d(a);if(t){x.push(K);const n=t.contains(document.activeElement)?f:document.activeElement;if(f=n,!t.contains(n)){const o=new Event(w,L);t.addEventListener(w,_),t.dispatchEvent(o),o.defaultPrevented||i((()=>{let o=e.focusStartEl;l(o)||(j(o),document.activeElement!==o&&(o="first")),"first"===o&&((e,t=!1)=>{const n=document.activeElement;for(const o of e)if(j(o,t),document.activeElement!==n)return})(N(t),!0),document.activeElement!==n&&"container"!==o||j(t)}))}}}function H(){const e=d(a);if(e){e.removeEventListener(w,_);const t=new CustomEvent(h,{...L,detail:{focusReason:b.value}});e.addEventListener(h,C),e.dispatchEvent(t),t.defaultPrevented||"keyboard"!=b.value&&R.value>S.value||j(null!=f?f:document.body),e.removeEventListener(h,_),x.remove(K)}}return o((()=>{e.trapped&&B(),c((()=>e.trapped),(e=>{e?B():H()}))})),s((()=>{e.trapped&&H()})),{onKeydown:I}}});e("E",p(q,[["render",function(e,t,n,o,s,r){return f(e.$slots,"default",{handleKeydown:e.onKeydown})}],["__file","/home/runner/work/element-plus/element-plus/packages/components/focus-trap/src/focus-trap.vue"]]))}}}));
//# sourceMappingURL=focus-trap-legacy-d9e8daf6.js.map
