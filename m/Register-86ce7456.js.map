{"version":3,"file":"Register-86ce7456.js","sources":["../../src/image/user/go-download.webp","../../src/view/user/Register.vue"],"sourcesContent":["export default \"data:image/webp;base64,UklGRmABAABXRUJQVlA4WAoAAAAQAAAAKQAAPAAAQUxQSMsAAAABgFTbdt3mQhAEQTAEQxCDikHMwI9BwqBmYDPQY2AzCASJwRs8/VeHHUTEBED/vIP0/567RdEGGf7K+SgTBgPARpnyBBBkUgcv2eeg7pwyEZ+Mx0jDShZWD8auGSf6qHG/IbvbCmQoQxVeytGM4gpZ/w6qSHYU6MkkdhjW91+qLUhtPJcBq7R+B1CTmInQzzZxjyOHhbj22kwDq7vQ22XcR8lriLkzi8/Ife693yGKTgBnJnSATXNcALCmGdgoGB6WNpQ9cer3XGShAQBWUDggbgAAABAEAJ0BKioAPQA+kTqSSCeSUZlVmFgJBLKAZR4aw93e9tbxhcbNoU6AAP7n5KE5xdgd2lNkCuevq4hTCZKrSPVa6uemhIiN54f6A2///ia8zgiqVWAHVKHyRHNhlD0wyQE7r0JtiHsuSewUQAAA\"","<template>\n  <Page bodyClass=\"Register p-lr-60 p-t-40 p-b-100\" :title=\"$t('form.register')\">\n    <Column class=\"w-100b font-54\">\n      <Row>Hi</Row>\n      <Row>{{ $t('user.registerTitle') }}</Row>\n    </Column>\n    <Row class=\"label h-88 m-t-10 m-b-30\" y=\"c\">\n      <Row :class=\"accountType == typeMap.phone ? 'c-primary tab-active' : 'c-info'\" class=\"tab transition h-88 m-r-60\" y=\"c\" @click=\"switchType(typeMap.phone)\">{{ $t('form.phone') }}</Row>\n      <Row :class=\"accountType == typeMap.email ? 'c-primary tab-active' : 'c-info'\" class=\"tab transition h-88\" y=\"c\" @click=\"switchType(typeMap.email)\">{{ $t('form.email') }}</Row>\n    </Row>\n    <el-form\n      ref=\"formRef\"\n      :model=\"form\"\n      :rules=\"rules\"\n      class=\"w-100b f-column\"\n    >\n      <el-form-item\n        v-if=\"accountType == typeMap.phone\"\n        key=\"phone\"\n        class=\"m-b-40 phone position-r\"\n        prop=\"phone\"\n      >\n        <Row class=\"position-a-tl w-150 h-88 p-l-20 z-1\" y=\"c\" x=\"sb\" @click=\"() => showAreaList = true\">\n          <span v-if=\"form.phoneAreaCode\">{{ form.phoneAreaCode }}</span>\n          <span v-else class=\"c-info\">{{ $t('form.selectpl') }}</span>\n          <van-icon class=\"label-sm c-info\" name=\"arrow-down\" />\n        </Row>\n        <el-input\n          v-model=\"form.phone\"\n          class=\"f-1\"\n          :placeholder=\"$t('form.inputPl', `form.phone`)\"\n          @keyup.enter=\"submit\"\n        />\n        <template #error=\"{ error }\">\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ error }}</Row>\n        </template>\n      </el-form-item>\n      <el-form-item\n        v-if=\"accountType == typeMap.email\"\n        key=\"email\"\n        class=\"m-b-40\"\n        prop=\"email\"\n      >\n        <el-input\n          v-model.trim=\"form.email\"\n          :placeholder=\"$t('form.inputPl', `form.email`)\"\n          @keyup.enter=\"submit\"\n        />\n        <template #error=\"{ error }\">\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ error }}</Row>\n        </template>\n      </el-form-item>\n      <!-- 验证码 -->\n      <el-form-item\n        key=\"verificationCode\"\n        class=\"m-b-40 position-r\"\n        prop=\"verificationCode\"\n      >\n        <Row v-if=\"updateCode\" class=\"w-100b position-r\">\n          <el-input\n            v-model=\"form.verificationCode\"\n            :maxlength=\"6\"\n            :placeholder=\"$t('form.verifyCode')\"\n            @input=\"(val)=>form.verificationCode = val.replace(/[^0-9]/g, '')\"\n            @keyup.enter=\"submit\"\n          />\n          <CodeButton\n            class=\"m-l-20 h-100b h-88 p-r-20\"\n            :account=\"account\"\n            :beforeClick=\"beforeClickGetCode\"\n            type=\"0\"\n            :phoneAreaCode=\"accountType == typeMap.phone?form.phoneAreaCode:''\"\n          />\n        </Row>\n        <template #error>\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ $t('form.inputPl','form.verifyCode') }}</Row>\n        </template>\n      </el-form-item>\n      <el-form-item\n        class=\"m-b-40\"\n        prop=\"loginPassword\"\n      >\n        <InputPwd\n          v-model=\"form.loginPassword\"\n          :placeholder=\"$t('form.inputPl','form.password')\"\n          :showPwdStrengt=\"false\"\n          @keyup.enter=\"submit\"\n          @blur=\"() => loginPasswordIsErr = !form.loginPassword\"\n        />\n        <Row class=\"label-sm lh-no m-t-5\" :class=\"loginPasswordIsErr ? 'c-error' : 'c-info'\">{{ $t('form.passwordLengthPassError') }}</Row>\n        <template #error>\n          <Row class=\"w-100b c-error label-sm lh-no  m-t-5\" />\n        </template>\n      </el-form-item>\n      <el-form-item class=\"m-b-40\" prop=\"inviteCode\">\n        <el-input\n          v-model=\"form.inviteCode\"\n          :placeholder=\"$t('form.inputPl', 'form.inviteCode')\"\n          @keyup.enter=\"submit\"\n        />\n      </el-form-item>\n      <Row class=\"w-100b m-b-10 label\" y=\"c\">\n        <el-checkbox v-model=\"readAndAccept\" size=\"large\" class=\"m-r-10\" />\n        <span class=\"c-black\">{{ $t(\"form.readAndAccept\") }}</span>\n        <span class=\"c-primary break-word m-l-10\" @click=\"toUserAgreement\">{{\n          $t(\"form.userAgreement\")\n        }}</span>\n\n      </Row>\n\n      <div class=\"w-100b m-b-20 \">\n        <van-button\n          class=\"w-100b title-sm\"\n          type=\"primary\"\n          :loading=\"loading\"\n          :disabled=\"submitDisabled\"\n          @click=\"submit\"\n        >{{ $t(\"form.register\") }}</van-button>\n      </div>\n      <Row class=\"w-100b c-info label-sm p-10\" x=\"c\" @click=\"() => router.push('/goDownload')\">\n        <img class=\"w-21 h-30 m-r-10\" src=\"@/image/user/go-download.webp\">\n        <span>{{ $t(\"public.appDownload\") }}</span>\n      </Row>\n    </el-form>\n    <!-- 手机区号选择 -->\n    <van-action-sheet v-model:show=\"showAreaList\" class=\"h-100b\" :round=\"false\">\n\n      <template #default>\n        <van-search\n          v-model=\"areaSearch\"\n          show-action\n          shape=\"round\"\n          :placeholder=\"$t('user.plsCountryCode')\"\n          @cancel=\"() => showAreaList = false\"\n        >\n          <template #action>\n            <Row class=\"font-24\" @click=\"showAreaList = false\">{{ $t('alert.cancel') }}</Row>\n          </template>\n        </van-search>\n        <Row\n          v-for=\"(e, i) in areaSearchList(areaList)\"\n          :key=\"i\"\n          y=\"c\"\n          x=\"sb\"\n          class=\"h-88 p-lr-30\"\n          @click=\"onAreaSelect(e)\"\n        >\n          <Row class=\"font-28\">\n            <img :src=\"e.icon\" onerror=\"this.src='/image/backup.webp'\" class=\"w-34 h-24 radius-2 m-r-17\">\n            <span>{{ e.nationalityName }}</span>\n          </Row>\n          <span class=\"c-info font-28\">{{ e.phoneAreaCode }}</span>\n        </Row>\n      </template>\n    </van-action-sheet>\n\n  </Page>\n\n</template>\n\n<script setup>\nconst route = useRoute()\n\nconst typeMap = {\n  'phone': 1,\n  'email': 2,\n}\nlet updateCode = $ref(true)\nconst formRef = $ref(null)\nlet accountType = $ref(typeMap.phone)\nlet loading = $ref(false)\nlet areaList = $ref([])\nconst areaSearch = $ref('')\nconst readAndAccept = $ref(false)\nlet account = $ref('')\n\nconst areaSearchList = () => {\n  if (!areaSearch) {\n    return areaList\n  }\n  const searchKeys = ['phoneAreaCode', 'nationalityName']\n  return areaList.filter(d => {\n    return d[searchKeys[0]].toString().indexOf(areaSearch.toString()) !== -1 || d[searchKeys[1]].toString().indexOf(areaSearch.toString()) !== -1\n  })\n}\n\nlet showAreaList = $ref(false)\nconst form = reactive({\n  phoneAreaCode: sessionStorage.phoneAreaCode,\n  phone: sessionStorage.phone ?? '',\n  email: sessionStorage.email ?? '',\n  loginPassword: sessionStorage.loginPassword ?? '',\n  verificationCode: sessionStorage.verificationCode ?? '',\n  inviteCode: route.query.inviteCode ?? '',\n})\nlet loginPasswordIsErr = $ref(false)\nconst submitDisabled = $computed(() => {\n  const key = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  return [!readAndAccept, hasEmpty(form[key], form.loginPassword, form.verificationCode)].some(v => v)\n})\n\nconst rules = {\n  phone: [\n    { required: true, message: $t('form.inputPl', 'form.phone'), trigger: 'blur' },\n    { validator: $v.el.check($v.re.phone, { errorText: () => $t('form.phoneError') }), trigger: 'blur' },\n    { validator: $v.el.check($v.re.lan, { errorText: () => $t('form.inputPl', 'form.passwordLengthPassError', 'public.de', 'form.phone') }), trigger: 'blur' },\n  ],\n  email: [\n    { required: true, message: $t('form.inputPl', 'form.email'), trigger: 'blur' },\n    { validator: (rule, value, callback) => $v.re.checkEmail(rule, value, callback), trigger: 'blur' },\n    // { validator: $v.el.check($v.re.lan255, { errorText: () => $t('form.inputPl', 'form.passwordLengthPassError255', 'public.de', 'form.email') }), trigger: 'blur' },\n  ],\n  verificationCode: [\n    { required: true, message: $t('form.inputPl', 'form.verifyCode'), trigger: 'blur' },\n  ],\n  loginPassword: [\n    {\n      required: true,\n      message: $t('form.inputPl', 'form.password'),\n      trigger: 'blur',\n    },\n  ]\n}\n\nconst toUserAgreement = () => {\n  toRouter(`/help?name=userAgreement&${location.search.replace('?', '')}`)\n}\n\nconst onAreaSelect = (e) => {\n  form.phoneAreaCode = e.phoneAreaCode\n  showAreaList = false\n}\n\nconst switchType = (v) => {\n  accountType = v\n}\n\nconst beforeClickGetCode = async () => {\n  if (accountType === 1) {\n    await $v.el.field(formRef, 'phone')\n    account = form.phone\n  } else {\n    await $v.el.field(formRef, 'email')\n    account = form.email\n  }\n  return true\n}\n\nconst getVerifyCode = async (obj = {}) => {\n  const ekey = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  if (isEmpty(form[ekey])) {\n    showNotify({ type: 'danger', message: $t('form.inputPl', `form.${ekey}`) })\n    throw $t('form.inputPl', `form.${ekey}`)\n  }\n\n  const body = {\n    type: 1,\n    smsType: 0,\n    phoneOrEmail: accountType,\n    ...obj\n  }\n  if (Number(accountType) === 1) {\n    body.phone = form.phone\n    body.phoneAreaCode = form.phoneAreaCode\n  } else {\n    body.email = form.email\n  }\n  const data = await userApi.getVerifyCode(body)\n  return data\n}\n\nconst verifyKeys = $computed(() => {\n  const key = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  return [key, 'verificationCode', 'loginPassword']\n})\n\nconst submit = async () => {\n  try {\n    await $v.el.field(formRef, verifyKeys)\n    if (!readAndAccept) {\n      showNotify({ type: 'danger', message: $t('form.readPl', 'form.userAgreement') })\n      return\n    }\n    loading = true\n    const body = {\n      ...form,\n      registerWay: accountType,\n      loginPassword: encrypt.md5(form.loginPassword),\n    }\n    if (accountType == typeMap.phone) {\n      delete body.email\n    }\n    if (accountType == typeMap.email) {\n      delete body.phone\n      delete body.phoneAreaCode\n    }\n\n    const data = await userApi.registered(body)\n    toRouter(`/user/registerSuccess?${location.search.replace('?', '')}`)\n  } catch (error) {\n    loginPasswordIsErr = !form.loginPassword\n  } finally {\n    loading = false\n  }\n}\n\nconst getAreaList = async () => {\n  const data = await userApi.areaList()\n  areaList = data\n  form.phoneAreaCode = areaList[0]?.phoneAreaCode\n}\n\nwatch(() => form.phoneAreaCode, (value) => {\n  // sessionStorage.phoneAreaCode = value\n})\nwatch(() => form.phone, (value) => {\n  sessionStorage.phone = value\n})\nwatch(() => form.email, (value) => {\n  sessionStorage.email = value\n})\nwatch(() => form.loginPassword, (value) => {\n  sessionStorage.loginPassword = value\n})\nwatch(() => form.verificationCode, (value) => {\n  sessionStorage.verificationCode = value\n})\n\nwatch(\n  () => accountType,\n  (val) => {\n    updateCode = false\n    setTimeout(() => {\n      updateCode = true\n    })\n  }\n)\n\nonBeforeMount(() => {\n  getAreaList()\n})\n</script>\n\n<style lang=\"scss\">\n.Register {\n  --van-action-sheet-max-height: 100%;\n  .phone{\n    .el-input__wrapper{\n      padding-left: 170px;\n    }\n  }\n  .tab {\n    border-bottom: 4px solid;\n    border-bottom-color: #fff;\n  }\n  .tab-active {\n    border-bottom-color: #2649EF;\n\n  }\n}\n</style>\n\n"],"names":["route","useRoute","typeMap","phone","email","updateCode","_ref","formRef","accountType","loading","areaList","areaSearch","readAndAccept","account","areaSearchList","value","searchKeys","filter","d","toString","indexOf","showAreaList","form","reactive","phoneAreaCode","sessionStorage","_a","_b","loginPassword","_c","verificationCode","_d","inviteCode","_e","query","loginPasswordIsErr","submitDisabled","_computed","key","Object","keys","find","k","hasEmpty","some","v","rules","required","message","$t","trigger","validator","$v","el","check","re","errorText","lan","rule","callback","checkEmail","toUserAgreement","toRouter","location","search","replace","switchType","beforeClickGetCode","async","field","verifyKeys","submit","showNotify","type","body","registerWay","encrypt","md5","userApi","registered","error","watch","val","setTimeout","onBeforeMount","data","getAreaList","e"],"mappings":"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"}