{"version":3,"file":"Register-legacy-096eb1fe.js","sources":["../../src/image/user/go-download.webp","../../src/view/user/Register.vue"],"sourcesContent":["export default \"data:image/webp;base64,UklGRmABAABXRUJQVlA4WAoAAAAQAAAAKQAAPAAAQUxQSMsAAAABgFTbdt3mQhAEQTAEQxCDikHMwI9BwqBmYDPQY2AzCASJwRs8/VeHHUTEBED/vIP0/567RdEGGf7K+SgTBgPARpnyBBBkUgcv2eeg7pwyEZ+Mx0jDShZWD8auGSf6qHG/IbvbCmQoQxVeytGM4gpZ/w6qSHYU6MkkdhjW91+qLUhtPJcBq7R+B1CTmInQzzZxjyOHhbj22kwDq7vQ22XcR8lriLkzi8/Ife693yGKTgBnJnSATXNcALCmGdgoGB6WNpQ9cer3XGShAQBWUDggbgAAABAEAJ0BKioAPQA+kTqSSCeSUZlVmFgJBLKAZR4aw93e9tbxhcbNoU6AAP7n5KE5xdgd2lNkCuevq4hTCZKrSPVa6uemhIiN54f6A2///ia8zgiqVWAHVKHyRHNhlD0wyQE7r0JtiHsuSewUQAAA\"","<template>\n  <Page bodyClass=\"Register p-lr-60 p-t-40 p-b-100\" :title=\"$t('form.register')\">\n    <Column class=\"w-100b font-54\">\n      <Row>Hi</Row>\n      <Row>{{ $t('user.registerTitle') }}</Row>\n    </Column>\n    <Row class=\"label h-88 m-t-10 m-b-30\" y=\"c\">\n      <Row :class=\"accountType == typeMap.phone ? 'c-primary tab-active' : 'c-info'\" class=\"tab transition h-88 m-r-60\" y=\"c\" @click=\"switchType(typeMap.phone)\">{{ $t('form.phone') }}</Row>\n      <Row :class=\"accountType == typeMap.email ? 'c-primary tab-active' : 'c-info'\" class=\"tab transition h-88\" y=\"c\" @click=\"switchType(typeMap.email)\">{{ $t('form.email') }}</Row>\n    </Row>\n    <el-form\n      ref=\"formRef\"\n      :model=\"form\"\n      :rules=\"rules\"\n      class=\"w-100b f-column\"\n    >\n      <el-form-item\n        v-if=\"accountType == typeMap.phone\"\n        key=\"phone\"\n        class=\"m-b-40 phone position-r\"\n        prop=\"phone\"\n      >\n        <Row class=\"position-a-tl w-150 h-88 p-l-20 z-1\" y=\"c\" x=\"sb\" @click=\"() => showAreaList = true\">\n          <span v-if=\"form.phoneAreaCode\">{{ form.phoneAreaCode }}</span>\n          <span v-else class=\"c-info\">{{ $t('form.selectpl') }}</span>\n          <van-icon class=\"label-sm c-info\" name=\"arrow-down\" />\n        </Row>\n        <el-input\n          v-model=\"form.phone\"\n          class=\"f-1\"\n          :placeholder=\"$t('form.inputPl', `form.phone`)\"\n          @keyup.enter=\"submit\"\n        />\n        <template #error=\"{ error }\">\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ error }}</Row>\n        </template>\n      </el-form-item>\n      <el-form-item\n        v-if=\"accountType == typeMap.email\"\n        key=\"email\"\n        class=\"m-b-40\"\n        prop=\"email\"\n      >\n        <el-input\n          v-model.trim=\"form.email\"\n          :placeholder=\"$t('form.inputPl', `form.email`)\"\n          @keyup.enter=\"submit\"\n        />\n        <template #error=\"{ error }\">\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ error }}</Row>\n        </template>\n      </el-form-item>\n      <!-- 验证码 -->\n      <el-form-item\n        key=\"verificationCode\"\n        class=\"m-b-40 position-r\"\n        prop=\"verificationCode\"\n      >\n        <Row v-if=\"updateCode\" class=\"w-100b position-r\">\n          <el-input\n            v-model=\"form.verificationCode\"\n            :maxlength=\"6\"\n            :placeholder=\"$t('form.verifyCode')\"\n            @input=\"(val)=>form.verificationCode = val.replace(/[^0-9]/g, '')\"\n            @keyup.enter=\"submit\"\n          />\n          <CodeButton\n            class=\"m-l-20 h-100b h-88 p-r-20\"\n            :account=\"account\"\n            :beforeClick=\"beforeClickGetCode\"\n            type=\"0\"\n            :phoneAreaCode=\"accountType == typeMap.phone?form.phoneAreaCode:''\"\n          />\n        </Row>\n        <template #error>\n          <Row class=\"w-100b c-error label-sm lh-no m-t-5\">{{ $t('form.inputPl','form.verifyCode') }}</Row>\n        </template>\n      </el-form-item>\n      <el-form-item\n        class=\"m-b-40\"\n        prop=\"loginPassword\"\n      >\n        <InputPwd\n          v-model=\"form.loginPassword\"\n          :placeholder=\"$t('form.inputPl','form.password')\"\n          :showPwdStrengt=\"false\"\n          @keyup.enter=\"submit\"\n          @blur=\"() => loginPasswordIsErr = !form.loginPassword\"\n        />\n        <Row class=\"label-sm lh-no m-t-5\" :class=\"loginPasswordIsErr ? 'c-error' : 'c-info'\">{{ $t('form.passwordLengthPassError') }}</Row>\n        <template #error>\n          <Row class=\"w-100b c-error label-sm lh-no  m-t-5\" />\n        </template>\n      </el-form-item>\n      <el-form-item class=\"m-b-40\" prop=\"inviteCode\">\n        <el-input\n          v-model=\"form.inviteCode\"\n          :placeholder=\"$t('form.inputPl', 'form.inviteCode')\"\n          @keyup.enter=\"submit\"\n        />\n      </el-form-item>\n      <Row class=\"w-100b m-b-10 label\" y=\"c\">\n        <el-checkbox v-model=\"readAndAccept\" size=\"large\" class=\"m-r-10\" />\n        <span class=\"c-black\">{{ $t(\"form.readAndAccept\") }}</span>\n        <span class=\"c-primary break-word m-l-10\" @click=\"toUserAgreement\">{{\n          $t(\"form.userAgreement\")\n        }}</span>\n\n      </Row>\n\n      <div class=\"w-100b m-b-20 \">\n        <van-button\n          class=\"w-100b title-sm\"\n          type=\"primary\"\n          :loading=\"loading\"\n          :disabled=\"submitDisabled\"\n          @click=\"submit\"\n        >{{ $t(\"form.register\") }}</van-button>\n      </div>\n      <Row class=\"w-100b c-info label-sm p-10\" x=\"c\" @click=\"() => router.push('/goDownload')\">\n        <img class=\"w-21 h-30 m-r-10\" src=\"@/image/user/go-download.webp\">\n        <span>{{ $t(\"public.appDownload\") }}</span>\n      </Row>\n    </el-form>\n    <!-- 手机区号选择 -->\n    <van-action-sheet v-model:show=\"showAreaList\" class=\"h-100b\" :round=\"false\">\n\n      <template #default>\n        <van-search\n          v-model=\"areaSearch\"\n          show-action\n          shape=\"round\"\n          :placeholder=\"$t('user.plsCountryCode')\"\n          @cancel=\"() => showAreaList = false\"\n        >\n          <template #action>\n            <Row class=\"font-24\" @click=\"showAreaList = false\">{{ $t('alert.cancel') }}</Row>\n          </template>\n        </van-search>\n        <Row\n          v-for=\"(e, i) in areaSearchList(areaList)\"\n          :key=\"i\"\n          y=\"c\"\n          x=\"sb\"\n          class=\"h-88 p-lr-30\"\n          @click=\"onAreaSelect(e)\"\n        >\n          <Row class=\"font-28\">\n            <img :src=\"e.icon\" onerror=\"this.src='/image/backup.webp'\" class=\"w-34 h-24 radius-2 m-r-17\">\n            <span>{{ e.nationalityName }}</span>\n          </Row>\n          <span class=\"c-info font-28\">{{ e.phoneAreaCode }}</span>\n        </Row>\n      </template>\n    </van-action-sheet>\n\n  </Page>\n\n</template>\n\n<script setup>\nconst route = useRoute()\n\nconst typeMap = {\n  'phone': 1,\n  'email': 2,\n}\nlet updateCode = $ref(true)\nconst formRef = $ref(null)\nlet accountType = $ref(typeMap.phone)\nlet loading = $ref(false)\nlet areaList = $ref([])\nconst areaSearch = $ref('')\nconst readAndAccept = $ref(false)\nlet account = $ref('')\n\nconst areaSearchList = () => {\n  if (!areaSearch) {\n    return areaList\n  }\n  const searchKeys = ['phoneAreaCode', 'nationalityName']\n  return areaList.filter(d => {\n    return d[searchKeys[0]].toString().indexOf(areaSearch.toString()) !== -1 || d[searchKeys[1]].toString().indexOf(areaSearch.toString()) !== -1\n  })\n}\n\nlet showAreaList = $ref(false)\nconst form = reactive({\n  phoneAreaCode: sessionStorage.phoneAreaCode,\n  phone: sessionStorage.phone ?? '',\n  email: sessionStorage.email ?? '',\n  loginPassword: sessionStorage.loginPassword ?? '',\n  verificationCode: sessionStorage.verificationCode ?? '',\n  inviteCode: route.query.inviteCode ?? '',\n})\nlet loginPasswordIsErr = $ref(false)\nconst submitDisabled = $computed(() => {\n  const key = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  return [!readAndAccept, hasEmpty(form[key], form.loginPassword, form.verificationCode)].some(v => v)\n})\n\nconst rules = {\n  phone: [\n    { required: true, message: $t('form.inputPl', 'form.phone'), trigger: 'blur' },\n    { validator: $v.el.check($v.re.phone, { errorText: () => $t('form.phoneError') }), trigger: 'blur' },\n    { validator: $v.el.check($v.re.lan, { errorText: () => $t('form.inputPl', 'form.passwordLengthPassError', 'public.de', 'form.phone') }), trigger: 'blur' },\n  ],\n  email: [\n    { required: true, message: $t('form.inputPl', 'form.email'), trigger: 'blur' },\n    { validator: (rule, value, callback) => $v.re.checkEmail(rule, value, callback), trigger: 'blur' },\n    // { validator: $v.el.check($v.re.lan255, { errorText: () => $t('form.inputPl', 'form.passwordLengthPassError255', 'public.de', 'form.email') }), trigger: 'blur' },\n  ],\n  verificationCode: [\n    { required: true, message: $t('form.inputPl', 'form.verifyCode'), trigger: 'blur' },\n  ],\n  loginPassword: [\n    {\n      required: true,\n      message: $t('form.inputPl', 'form.password'),\n      trigger: 'blur',\n    },\n  ]\n}\n\nconst toUserAgreement = () => {\n  toRouter(`/help?name=userAgreement&${location.search.replace('?', '')}`)\n}\n\nconst onAreaSelect = (e) => {\n  form.phoneAreaCode = e.phoneAreaCode\n  showAreaList = false\n}\n\nconst switchType = (v) => {\n  accountType = v\n}\n\nconst beforeClickGetCode = async () => {\n  if (accountType === 1) {\n    await $v.el.field(formRef, 'phone')\n    account = form.phone\n  } else {\n    await $v.el.field(formRef, 'email')\n    account = form.email\n  }\n  return true\n}\n\nconst getVerifyCode = async (obj = {}) => {\n  const ekey = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  if (isEmpty(form[ekey])) {\n    showNotify({ type: 'danger', message: $t('form.inputPl', `form.${ekey}`) })\n    throw $t('form.inputPl', `form.${ekey}`)\n  }\n\n  const body = {\n    type: 1,\n    smsType: 0,\n    phoneOrEmail: accountType,\n    ...obj\n  }\n  if (Number(accountType) === 1) {\n    body.phone = form.phone\n    body.phoneAreaCode = form.phoneAreaCode\n  } else {\n    body.email = form.email\n  }\n  const data = await userApi.getVerifyCode(body)\n  return data\n}\n\nconst verifyKeys = $computed(() => {\n  const key = Object.keys(typeMap).find((k) => accountType == typeMap[k])\n  return [key, 'verificationCode', 'loginPassword']\n})\n\nconst submit = async () => {\n  try {\n    await $v.el.field(formRef, verifyKeys)\n    if (!readAndAccept) {\n      showNotify({ type: 'danger', message: $t('form.readPl', 'form.userAgreement') })\n      return\n    }\n    loading = true\n    const body = {\n      ...form,\n      registerWay: accountType,\n      loginPassword: encrypt.md5(form.loginPassword),\n    }\n    if (accountType == typeMap.phone) {\n      delete body.email\n    }\n    if (accountType == typeMap.email) {\n      delete body.phone\n      delete body.phoneAreaCode\n    }\n\n    const data = await userApi.registered(body)\n    toRouter(`/user/registerSuccess?${location.search.replace('?', '')}`)\n  } catch (error) {\n    loginPasswordIsErr = !form.loginPassword\n  } finally {\n    loading = false\n  }\n}\n\nconst getAreaList = async () => {\n  const data = await userApi.areaList()\n  areaList = data\n  form.phoneAreaCode = areaList[0]?.phoneAreaCode\n}\n\nwatch(() => form.phoneAreaCode, (value) => {\n  // sessionStorage.phoneAreaCode = value\n})\nwatch(() => form.phone, (value) => {\n  sessionStorage.phone = value\n})\nwatch(() => form.email, (value) => {\n  sessionStorage.email = value\n})\nwatch(() => form.loginPassword, (value) => {\n  sessionStorage.loginPassword = value\n})\nwatch(() => form.verificationCode, (value) => {\n  sessionStorage.verificationCode = value\n})\n\nwatch(\n  () => accountType,\n  (val) => {\n    updateCode = false\n    setTimeout(() => {\n      updateCode = true\n    })\n  }\n)\n\nonBeforeMount(() => {\n  getAreaList()\n})\n</script>\n\n<style lang=\"scss\">\n.Register {\n  --van-action-sheet-max-height: 100%;\n  .phone{\n    .el-input__wrapper{\n      padding-left: 170px;\n    }\n  }\n  .tab {\n    border-bottom: 4px solid;\n    border-bottom-color: #fff;\n  }\n  .tab-active {\n    border-bottom-color: #2649EF;\n\n  }\n}\n</style>\n\n"],"names":["route","useRoute","typeMap","phone","email","updateCode","_ref","formRef","accountType","loading","areaList","areaSearch","readAndAccept","areaSearchList","value","searchKeys","filter","d","toString","indexOf","showAreaList","form","reactive","phoneAreaCode","sessionStorage","_sessionStorage$phone","_sessionStorage$email","loginPassword","_sessionStorage$login","verificationCode","_sessionStorage$verif","inviteCode","_route$query$inviteCo","query","submitDisabled","_computed","key","Object","keys","find","k","hasEmpty","some","v","required","message","$t","trigger","validator","$v","el","check","re","errorText","lan","rule","callback","checkEmail","toUserAgreement","toRouter","location","search","replace","switchType","beforeClickGetCode","async","field","account","verifyKeys","submit","showNotify","type","registerWay","encrypt","md5","body","registered","error","loginPasswordIsErr","watch","val","setTimeout","onBeforeMount","_areaList$value$","data","userApi","getAreaList","e"],"mappings":"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"}